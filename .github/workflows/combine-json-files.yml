name: Combine JSON Files

on:
  push:
    branches:
      - main  # Burada 'main' branch'ini hedefliyoruz

jobs:
  combine_json_files:
    runs-on: ubuntu-latest

    steps:
      # Yalnızca "kaynak" Klasörünü Çek
      - name: Set up git and sparse-checkout
        run: |
          git init
          git remote add origin https://github.com/benolanben/atesiask.git
          git config core.sparseCheckout true
          echo "kaynak" >> .git/info/sparse-checkout
          git pull origin main

      # JSON Dosyalarını Kontrol Et
      - name: Validate JSON Files
        run: |
          echo "Validating baska.json..."
          jq '.' kaynak/baska.json || { echo "Error in baska.json"; exit 1; }
          echo "Validating saz.json..."
          jq '.' kaynak/saz.json || { echo "Error in saz.json"; exit 1; }

      # JSON Dosyalarını Birleştir
      - name: Combine "sesler" Arrays
        run: |
          echo "Combining sesler from JSON files..."
          mkdir -p kaynak  # "kaynak" klasörünün varlığını garantiye al
          jq -s '{sesler: map(.sesler) | add}' kaynak/baska.json > kaynak/yeni.json || { echo "Failed to combine JSON files"; exit 1; }

      # Değişiklikleri Commit Et ve Pushla
      - name: Commit and push changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add kaynak/yeni.json
          git commit -m "Combine sesler arrays into yeni.json"
          git push --set-upstream origin master

